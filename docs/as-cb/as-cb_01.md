# 第一章。欢迎来到 Android Studio

在本章中，我们将涵盖与 Android Studio 相关的一些基本任务。在阅读本章和其他章节时，您将学习如何有效地使用 Android Studio。

在本章中，您将学习以下配方：

+   创建您的第一个名为`Hello Android Studio`的应用程序。

+   使用 Gradle 构建脚本

+   使用名为 Genymotion 的模拟器测试您的应用程序

+   重构您的代码

# 介绍

本章是对 Android Studio 的介绍，并提供了这个**集成开发环境（IDE）**所配备的不同工具的概览。除此之外，还将在这里讨论一些其他重要的工具，比如 Genymotion，我强烈建议您使用它来测试您的应用在不同类型的设备上。

使用 Android Studio，您可以创建任何您喜欢的应用程序。手机应用程序、平板电脑应用程序、手表和其他可穿戴设备应用程序、谷歌眼镜、电视应用程序，甚至汽车应用程序。

如果您已经有移动编程经验，甚至以前使用过 Android 应用程序和 Eclipse，并且想要了解如何创建拍照、播放媒体、在任何设备上工作、连接到云端或者您能想到的其他任何功能的应用程序，那么这本书就适合您！

本书中描述的所有配方都是基于 Mac 上的 Android Studio；但是，如果您使用的是 Windows 或 Linux 上的 Android Studio，这一点完全没有问题。所有平台的术语都是相同的。只是每个配方提供的截图可能看起来有点不同，但我相信您可以通过一点努力找出来。如果 Windows 有任何重大差异，我会告诉您的。

## 为什么我们应该使用 Android Studio

Android Studio 是开发 Android 应用程序的推荐 IDE，对于任何开发专业 Android 应用程序的人来说都是免费的。Android Studio 基于 JetBrains IntelliJ IDEA 软件，这可能解释了为什么即使 Android Studio 的预览和测试版本都比 Eclipse 更好，以及为什么许多 Android 开发人员从一开始就使用它作为他们的 IDE。

Android Studio 的第一个稳定版本于 2014 年 12 月发布，取代了 Eclipse（带有 Android 开发工具）成为 Android 开发的主要 IDE。现在，有了 Android Studio，我们不仅拥有了一个更稳定和更快的 IDE，而且还有了一些很酷的东西，比如 Gradle、更好的重构方法和更好的布局编辑器，仅举几例。

好吧，我偶尔还是会遇到一些奇怪的问题（我想这就是作为移动开发人员有时会遇到的情况），但我肯定不会像在使用 Eclipse 时那样感到沮丧。如果您只是使用 Eclipse 进行普通的 Java 开发，我想那也还好；但是，它与 Android 不兼容。如果您以前在 Java 开发任务中使用过 IntelliJ IDEA，那么 Android Studio 对您来说会看起来非常熟悉。

Android Studio 真的让移动开发变得有趣起来。如果您目前正在使用 Eclipse，那么您应该立即切换到 Android Studio！要亲自看看，请从[`developer.android.com/sdk/index.html`](https://developer.android.com/sdk/index.html)获取它，并立即开始使用 Android Studio 构建酷炫的应用程序。

## 碎片化

留下的是 Android 开发中需要处理的碎片化挑战。有许多设备运行在许多 Android 版本和版本上。

有很多 Android 版本，导致了碎片化。因此，您不能期望所有设备都能运行在最新的 Android 版本上。事实上，大多数设备都没有。许多设备仍在运行 Android 4.x（甚至更旧的版本）。

在这里，您可以看到一个包含所有相关 Android 版本和分发数字的表格。这个表格中的数字表明，如果您决定支持 Android 4.0 及以后的版本，您将能够触及 88.7%的所有 Android 用户。在这个例子中，显示了 2015 年第二季度的数字，这解释了为什么**Android Marshmallow (6.0)**在这里没有列出。如果您在 Android Studio 中创建一个新项目，您可以通过在**创建新项目**向导对话框中点击**帮助我选择**链接来获取实际的数字，这将在接下来的章节中找出。

让我们来看一下下面的屏幕截图，描述了不同 Android 平台版本的累积分布以及它们的 API 级别：

![碎片化](img/B04299_01_05.jpg)

除了软件碎片化之外，还有许多硬件碎片化需要注意。编写 Android 应用程序并不难，但编写一个能够在任何 Android 设备上正常运行的应用程序确实很难。

一个好的应用程序应该能够在尽可能多的不同设备上运行。例如，想象一个拍照的应用程序。Android 设备可能有一个摄像头，多个摄像头，或者根本没有摄像头。根据您的应用程序提供的其他功能，您可能还需要担心其他事情，比如设备是否能够录制声音等。

我可以想象你想要触及尽可能多的受众，所以你应该始终问自己，你的应用功能需求中哪些是必须的，哪些是不必要的。如果设备没有摄像头，用户可能无法拍照，但这真的是不允许用户使用应用的理由吗？

在 Android Marshmallow (6.0)中引入运行时权限使您更加重视在应用程序中提供某种后备功能。至少您需要解释为什么某个特定功能在您的应用程序中不可用。例如，用户设备不支持它或用户没有为其授予权限。

这本书将帮助您处理 Android 碎片化和其他问题。

# 创建您的第一个名为 Hello Android Studio 的应用程序

下载 Android Studio 后，安装并按照设置向导进行操作。向导会检查一些要求，例如**Java 开发工具包**（JDK）是否可用，以及其他重要的元素，安装向导会引导您完成这些操作。

安装完成后，是时候使用 Android Studio 开发您的第一个 Android 应用程序了，只是为了检查一切是否已正确安装并且正常运行。这可能不会让人感到意外，这就是 Hello Android Studio 教程的用武之地。

## 准备就绪

要完成这个教程，你需要一个运行中的 Android Studio IDE，一个 Android 软件开发工具包（SDK）和一个 Android 设备。不需要其他先决条件。

## 如何做...

让我们使用 Android Studio 创建我们的第一个 Android 应用程序，以检查一切是否正常运行，以下是帮助的步骤：

1.  启动 Android Studio。几秒钟后，**欢迎使用 Android Studio**对话框将显示给您。

1.  选择**开始一个新的 Android Studio 项目**选项。然后，**配置您的新项目**对话框将出现。

1.  对于**应用程序名称**，输入`HelloAndroidStudio`；对于**公司域**字段，输入`packtpub.com`（或者如果您愿意，可以使用您自己公司的域名）。

1.  建议使用`packtpub.com`和`helloandroidstudio`等包名称，并在输入时进行更新。如果愿意，可以在单击“下一步”按钮之前编辑**项目位置**。

1.  在**目标 Android 设备**对话框中，选中**手机和平板电脑**选项。不要选择其他选项。稍后我们将创建一些其他有趣的目标，比如 Android Wear 应用程序。对于**最低 SDK**，请选择**API 14**。如果该选项尚未（尚）可用，请单击其他可用的 SDK。单击**下一步**按钮继续。

1.  在下一个对话框中**为移动设备添加活动**，选择**空白活动**选项，然后单击**下一步**按钮。

1.  在此之后将显示最终对话框**自定义活动**。保持所有值不变，然后单击**完成**按钮。

1.  Android Studio 现在将为您创建这个新应用程序。过一会儿，项目视图、一个**MainActivity**类和一个**activity_main.xml**布局将显示出来。如果您通过单击左侧 Android Studio 上显示绿色小安卓人和文字为**Android**的按钮，将项目视图的视角从**Android**更改为**项目**，布局看起来会更像您习惯的样子，也就是说，如果您以前使用过 Eclipse。

1.  双击**app**文件夹以展开它。您会注意到一个名为`build.gradle`的文件（请注意，此文件也存在于根级别）。

1.  双击`build.gradle`文件以打开它，并查看`compileSdkVersion`、`minSdkVersion`和`targetSdkVersion`的值。默认情况下，`compileSdkVersion`的值始终与最新（可用）的 SDK 相关。`minSdkVersion`的值是您在**目标 Android 设备**对话框中选择的值。

### 注意

如果您希望使用不同的 SDK 进行编译，您必须更改`compileSdkVersion`的值。您选择的版本可能需要先安装。如果您对当前的配置满意，请立即转到第 14 步。

1.  如果您想要检查已安装了哪些 SDK，请从主菜单中选择**工具**选项，然后从**SDK Manager**子菜单中选择**Android**。![如何操作...](img/B04299_01_04.jpg)

1.  **Android** **SDK Manager**对话框显示了已安装的 SDK。如果您需要安装其他 SDK，您可以选中所需的元素，然后单击**安装 n 个软件包...**按钮。

1.  安装所需的 SDK 并配置好您的`build.gradle`文件后，您现在可以运行您的应用程序了。

1.  如果您要用物理设备进行 Android 开发，您需要先解锁开发者选项。在您的设备上，启动**设置**应用程序，然后转到**设备信息**选项。（此选项可能位于**常规**选项卡或部分，或者根据您的设备运行的 Android 版本和风格而在其他位置）。

### 注意

如果您没有真实设备，我强烈建议您尽快获取一个。您现在可以使用模拟器。您可以使用 Android SDK 附带的模拟器，或者您可以先阅读有关 Genymotion 的教程，了解如何使用模拟设备。

1.  在**设备信息**视图中，向下滚动直到看到**构建号**选项。现在，点击七（7）次**构建号**以解锁（启用）开发者模式。（不，这不是一个玩笑）。您现在已经解锁了开发者菜单。

### 注意

在较旧的 Android 版本（4.2 以下），此步骤可能会被跳过，或者如果开发者选项已经作为设置应用程序中的菜单项可用，此步骤可能会被跳过。

1.  现在您的**设置**应用程序中有一个名为**开发者选项**的新选项，请单击它并查看。重要的是您在此菜单中启用**USB 调试**选项。此外，您可能希望启用或禁用其他一些选项。

1.  通过单击 Android Studio 旁边的下拉框中读取应用程序的绿色三角形，连接您的设备并从 Android Studio 运行您的应用程序。或者，从**运行**菜单中选择**运行...**选项。然后，**选择设备**对话框将出现。您的设备现在应该出现在**选择运行设备**选项的列表中。（如果您的设备未出现在列表中，请重新连接您的设备。）

1.  点击**确定**按钮。（对于 Windows，在您能够连接设备之前，通常需要先安装驱动程序。）

1.  在您的设备上，可能会弹出一个对话框，要求您接受指纹。选择**允许**以继续。

应用程序现在正在部署到您的设备上。如果一切顺利，您的新应用程序现在将显示在您的设备上，上面写着**Hello world!**万岁！我承认这并不是一个非常令人兴奋的应用程序，但至少我们现在知道 Android Studio 和您的设备已经正确配置。

## 它是如何工作的...

Android Studio 将处理应用程序设置的基本部分。您只需要选择应用程序的目标和最低 SDK。目前使用 API 级别 14（Android 4.0）是最佳选择，因为这将使您的应用程序能够在大多数 Android 设备上运行。

应用程序将由 Android Studio 针对所选择的（编译）SDK 进行编译。

应用程序将被复制到您的设备上。启用**USB 调试**选项将有助于您解决任何问题，我们稍后将会发现。

# Gradle 构建脚本的使用

Android Studio 使用 Gradle 构建脚本。它是一个项目自动化工具，使用**领域特定语言**（**DSL**）而不是更常见的 XML 形式来创建项目的配置。

项目附带一个顶级构建文件和每个模块的构建文件。这些文件称为`build.gradle`。大多数情况下，只有应用程序模块的构建文件需要您的注意。

### 注意

您可能会注意到，以前在 Android 清单文件中找到的一些属性，例如目标 SDK 和版本属性，现在在构建文件中定义，并且应该仅驻留在构建文件中。

典型的`build.gradle`文件可能如下所示：

```kt
applylugin: 'com.android.application'
android {
  compileSdkVersion 21
  buildToolsVersion "21.0.0"
  defaultConfig {
  minSdkVersion 8
  targetSdkVersion 21
  versionCode 1
  versionName "0.1"
  } 
}
dependencies {
  compile fileTree(dir: 'libs', include: ['*.jar'])
}
```

Gradle 构建系统现在不是您需要过多担心的东西。在以后的教程中，我们将看到它的真正威力。该系统还设计用于支持在创建 Android 应用程序时可能面临的复杂场景，例如处理为各种客户定制的相同应用程序的版本（构建风格）或为不同设备类型或不同 Android OS 版本创建多个 APK 文件。

目前，只需知道这是我们将定义`compileSdkVersion`，`targetSdkVersion`和`minSdkVersion`的地方，就像您之前在使用 Eclipse 时在清单文件中所做的那样。

此外，这也是我们定义`versionCode`和`versionName`的地方，这反映了您的应用程序的版本，如果有人要更新您编写的应用程序，这将非常有用。

Gradle 功能的另一个有趣的关键元素是依赖关系。依赖关系可以是本地或远程库和 JAR 文件。项目依赖于它们以便能够编译和运行。在您将在上一个文件夹中找到的`app`文件夹中的`build.gradle`文件中，您将找到库所在的定义的存储库。`jCenter`是默认存储库。

例如，如果您希望添加`Parse`功能，这是我们将在下一章的教程中做的事情，以下依赖声明将向您的项目添加本地 Parse 库：

```kt
dependencies {
compile fileTree(dir: 'libs', include: 'Parse-*.jar')compile project(':Parse-1.9.1')
}
```

使用外部库变得更加容易。例如，如果你想添加`UniversalImageLoader`，一个用于从互联网加载图像的知名库，或者如果你想要使用`Gson`库的功能，它基本上是 JSON 数据的对象包装器，那么以下依赖声明将使这些库可用于项目：

```kt
dependencies {
compile 'com.google.code.gson:gson:2.3+'
compile 'com.nostra13.universalimageloader:universal-image-loader:1.9.3'
}
```

## 还有更多...

下一章的食谱中将解释一些其他 Gradle 概念。Gradle 是一个可以写一本书的话题，如果你想了解更多关于它的信息，你可以在互联网上找到许多有趣的深入教程。

## 另请参阅

+   有关 Gradle 构建脚本的更多信息，请参阅第二章，*带有基于云的后端的应用程序*

# 使用名为 Genymotion 的模拟器测试你的应用程序

测试你的应用程序的最佳方法是使用真实设备。Android 模拟器非常慢，而且没有提供真实设备所具有的所有功能，比如相机和各种传感器。

我可以想象你可能只有一个或几个设备。有成千上万的 Android 设备可用，许多品牌和型号都在定制的（例如三星设备）或纯净的（如 Nexus 设备）Android OS 版本上运行，而且你能想到的任何 Android 版本上进行真机测试都会变得非常昂贵。

例如，如果你正在创建一个应该在 Android 2.3、Android 4.x 和 Android 5.x 上运行良好的应用程序，使用模拟设备可能会很方便。不幸的是，默认的模拟器非常慢。在模拟器上启动 Android 需要很长时间，调试也可能非常慢。为了让模拟器快一点，你可以尝试安装**硬件加速执行管理器**（**HAXM**）。有一些关于如何做到这一点的主题在互联网上，然而，有一个更好的解决方案，那就是 Genymotion。

Genymotion 是一个真实、快速、易于使用的模拟器，并且具有许多真实设备配置。你可以在其网站[www.genymotion.com](http://www.genymotion.com)上了解更多关于 Genymotion 的信息。它有免费和付费版本可用。免费版本对于起步来说是可以的。

## 准备工作

确保你有互联网访问权限和足够的硬盘空间。我们需要下载 VirtualBox 和 Genymotion。之后，你就可以准备创建你的第一个虚拟设备了。让魔法开始吧。

## 如何做...

让我们安装 Genymotion 以准备 Android Studio 与运行流畅的模拟设备一起使用：

1.  需要安装 Oracle 的 VirtualBox 和 Genymotion 应用程序。这是因为 Genymotion 在后台使用**Oracle 虚拟机**（**VM**）VirtualBox 的虚拟化技术来虚拟化各种 Android 操作系统。如果你的计算机上还没有安装 Oracle VM VirtualBox（或者你的 VirtualBox 版本低于 4.1.1，不兼容 Genymotion），你需要先安装它。

从 VirtualBox 下载页面下载适用于 OS X 主机（或 Windows）的 VirtualBox，网址为[`www.virtualbox.org/wiki/Downloads`](https://www.virtualbox.org/wiki/Downloads)。

安装 VirtualBox，然后重新启动计算机。

从 Genymotion 的网页[`www.genymotion.com/#!/download`](https://www.genymotion.com/#!/download)下载 Genymotion。

1.  现在，打开并安装下载的文件。

1.  运行 Genymotion。然后会有一个对话框询问你是否要创建一个新设备。点击**是**按钮来创建。之后，你可以通过在主屏幕上点击*+*（加号）按钮来创建额外的设备。

1.  在对话框的左侧下拉列表中选择 Android OS 版本。

1.  从中心的下拉列表中选择一个虚拟设备（品牌和型号），然后点击**下一步**按钮。

1.  给您的设备命名。建议您在设备名称中包括设备和操作系统版本，以便在以后使用时可以轻松识别您正在测试的内容。

1.  单击**下一步**按钮确认名称。您的虚拟设备将被创建，并出现在 Genymotion 主屏幕的列表中。根据需要创建多个虚拟设备。

1.  要运行虚拟设备，请选择它，然后单击**播放**按钮。它将启动 Genymotion 模拟器，以便您可以与 Android Studio 一起使用。启动后，您可以解锁设备，使其准备好使用。

1.  如果您再次点击 Android Studio 中的**运行**按钮，您会注意到正在运行的虚拟设备显示在**选择设备**对话框中的可用设备列表中。只需单击**确定**按钮，魔法就会开始。您的 Android 应用程序将在模拟器上启动。

它运行得又快又顺畅！相当酷，不是吗？

以下是 Genymotion 主屏幕的示例，列出了已创建的一些虚拟设备：

![如何做...](img/B04299_01_01.jpg)

## 还有更多...

Genymotion 配备了模拟的前端和/或后端摄像头，具体取决于所选择的配置。要启用它们，请单击相机图标。一个新的对话框出现，您可以在其中将滑块更改为**打开**，并为虚拟设备的前端和后端摄像头选择一个真实相机。

选择相机后，您可以关闭对话框。相机按钮旁边现在会出现一个绿色复选框。现在，每当应用程序需要使用相机时，它将使用所选的相机，我这里是笔记本电脑上的网络摄像头。要检查这是否有效，请在虚拟设备上选择相机应用程序。

Genymotion 的付费版本提供了额外的功能，包括模拟传感器，如 GPS 和加速计。如果愿意，您可以在[`www.genymotion.com/#!/store`](https://www.genymotion.com/#!/store)上查看差异。

请记住，虽然使用虚拟设备进行测试目的在 Genymotion 上非常出色，但始终重要的是在多个真实设备上进行测试。一些问题，特别是与内存管理相关的问题，稍后在本书中我们将看到，很容易在真实设备上重现，但在虚拟设备上可能会更难一些。

除此之外，真实设备更加像素完美，一些问题可能只会出现在特定设备上，因此在查看艺术品外观时，您将需要一些设备。

当您的应用程序几乎完成时，您可能会对 Testdroid 的（付费）服务感兴趣，这是一个基于云的服务，允许在许多真实设备上运行（自动化）测试。访问[www.testdroid.com](http://www.testdroid.com)了解更多关于这项伟大服务的信息！

以下截图提供了一个示例，显示了在 Genymotion 上运行的虚拟 Nexus 5 设备上运行的 Hello Android Studio 应用程序：

![还有更多...](img/B04299_01_02.jpg)

# 重构您的代码

优秀的软件工程师会不断地重构他们的工作。方法和成员的名称应始终指示它们正在做什么。由于业务需求在开发过程中经常发生变化，特别是在采用敏捷方法时，您的应用程序也会发生变化。

如果您选择正确的名称，并遵守方法长度必须限制在最多一页滚动以查看整个方法的规则，通常您不需要许多注释来解释您的代码在做什么。如果很难为特定方法想出一个好的名称，那么它可能做得太多了。

由于更改名称可能令人恐惧，因为它可能破坏你的代码，开发人员通常选择不这样做。或者，他们决定以后再做。提前这样做可以节省几分钟。如果其他人查看你的代码，或者一年后再看你的代码，你的代码可能很难理解。查找方法的功能可能非常耗时。方法的描述性名称可以解决这个问题。

好消息是，使用 Android Studio，重构是轻松而相当容易的。只需高亮显示成员或方法的名称，右键单击它，然后从弹出的上下文菜单中选择**重构**项目。

在选择**重构**项目时出现的**重构**子菜单中，你会发现许多有趣的选项。在这里你将使用的一个选项，也是你将经常使用的选项是**重命名…**选项。

## 操作步骤…

以下步骤描述了如何在“重构”子菜单中重命名方法：

1.  高亮显示您想要重命名的方法的名称。

1.  从上下文菜单中选择**重构**。

1.  从子菜单中选择**重命名** (或使用快捷键*Shift* + *F6*)。

1.  现在，你可以就地重命名你的方法或成员，并通过按下*Enter*按钮应用更改。Android Studio 会为你提供一些建议，你可以接受这些建议，或者你可以输入你想要的名称。

### 提示

如果重复步骤 2 和 3，将会出现一个对话框，你可以在其中编辑名称。(或者使用快捷键*Shift* + *F6*两次)。

1.  单击**预览**按钮，查看重命名的效果。

1.  在屏幕底部，会出现一个新视图，显示重命名在每个文件（类、资源或其他）中的影响。

1.  在该视图中单击**执行重构**按钮以应用所有更改。

以下截图显示了就地重构(重命名)的示例。

![操作步骤…](img/B04299_01_03.jpg)

## 它是如何工作的…

Android Studio 会负责在整个项目中重命名方法或成员以及对它的任何引用。这包括 Java 类、布局、可绘制对象，以及你能想到的任何其他东西。

**重构**菜单中还有许多其他有趣的选项可供使用。其中一些将在下一章的示例中讨论，它们将会派上用场。

现在，让我们继续下一章，构建一个真正的应用程序，好吗？

## 另请参阅

+   有关重构代码的更多信息，请参阅第八章, *提高质量*。
