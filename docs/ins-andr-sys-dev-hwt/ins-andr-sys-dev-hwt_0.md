# 前言

欢迎来到《即时 Android 系统开发指南》。本书对 Android 操作系统内部进行了温和的介绍。如果你曾经想知道 Android 在幕后是如何工作的，那么这本书适合你。我经常思考这个问题，不得不花数小时研究成千上万行的代码，才能理解 Android 到底是什么。这本书是我在这个平台上工作三年多的经验的总结，我希望它能减轻 Android 系统开发的学习曲线。读者可以专注于核心概念，并在短时间内开始构建有用的 Android 修改。这本书将帮助你开始构建你自己的 Android 版本。本书内容全面，涵盖了 Android 系统开发的各个方面，从下载源代码到在真实设备上刷入自定义代码。

# 本书内容包括

构建 Android 让您快速了解如何下载 Android 源代码并进行构建。对于许多有抱负的 Android 系统开发人员来说，这是一个必经之路，而这本教程将帮助您完成这段旅程。

源代码组织和系统启动被解释了，因为 Android 代码库庞大，有效的开发包括了解这些代码。这些教程的初始部分向读者介绍了源代码的各个部分。后面的部分详细描述了 Android 启动的过程。

Android 系统开发中的常见设计模式涵盖了 Android 系统中的常见模式。了解这些模式对于开发高质量的代码至关重要。它还通过描述几种最佳实践来节省精力。

创建系统服务器的教程指导您完成创建自定义系统服务器的完整示例，这是 Android 系统开发中最基本的设计模式之一。从创建基本接口文件到将代码添加到现有的启动顺序，所有内容都包括在内。

分析 Android 系统分区解释了 Android 模拟器和几个真实设备上系统分区的组织。了解这些知识是学习如何安全正确地向设备刷入新操作系统版本的先决条件。

为特定设备编译理解大多数读者都希望在真实设备上测试他们的代码；然而，为特定设备获取正确的构建需要一些实验和风险。这个教程旨在通过指导读者完成明确定义的步骤来获取正确的构建，从而消除风险。

使用 Fastboot 刷机是向设备刷入新操作系统版本的最常见和首选方法。本教程指导读者在不破坏设备的风险下，将自定义代码安装到设备上的过程。

创建类库旨在帮助希望发布自定义内容的读者。做到这一点的常见方法是使用类库作为系统服务器的前端。本教程通过详细示例描述了这个过程。它还涵盖了使用新类库构建自定义 SDK 的过程。

根据上一个教程的逻辑问题，构建针对新 SDK 的应用程序跳到了下一个问题，即：我如何在正常的开发工作流程中实际使用这些新类？这个教程回答了如何使用自定义 SDK 版本构建应用程序的问题。

平台库介绍读者另一个设计模式——平台库。这是谷歌推荐的一种技术，可以在 Android 基础上包含额外的代码，而无需修改核心框架文件，除非绝对需要。

系统服务器的本地代码描述了如何在基于 Java 的系统服务器中使用本地组件。这是高级教程之一，解释了如何将本地代码添加到系统服务器中。

*分析 ActivityManagerService*深入探讨了 Android 上某些核心系统服务器的工作原理。这对于希望修改核心框架文件的任何读者都至关重要。在本章中，我们将介绍可能是最重要的系统服务器之一的几个重要方面，包括如何向 Activity Manager 服务添加新方法。

*向框架添加自定义权限*是一个非常重要的示例，描述了如何正确地保护读者添加的代码。它描述了 Android 权限框架，并解释了如何扩展它以适应额外的权限。

*分析 PackageManagerService*继续我们对核心服务的分析，看看`PackageManagerService`类，这对于安装在设备上的所有代码和所有权限检查都是至关重要的。

*修改系统应用程序*解释了因为 Android 附带了许多标准系统应用程序，您有时可能需要向这些应用程序添加额外功能，这个示例教会读者如何做到这一点。

*更快构建的提示和技巧*给出了一些关于如何加快 Android 源代码构建速度的指针，否则这可能会非常痛苦，因为它们往往需要很长时间。

# 您需要为本书做好准备

您需要一台安装了 Ubuntu 的现代 64 位计算机（最好是 10.04、10.10 或 11.10）。内存越大越好，但不少于 4GB。要将代码刷入设备，您还需要一部 Google 的开发者手机。

# 这本书是为谁准备的

这本书主要面向希望开始使用 Android 系统代码的系统开发人员。因此，假定您对 Linux 系统代码有一定的了解。但是，它也可以被希望了解 Android 内部工作方式以便编写更好应用程序的 Android SDK 开发人员使用。最后，好奇的读者也是预期受众的一部分。

# 会议

在本书中，您会发现一些文本样式，用于区分不同类型的信息。以下是一些这些样式的示例，以及它们的含义解释。

文本中的代码单词、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟 URL、用户输入和 Twitter 句柄显示如下：“`init1()`方法在`ANDROID_SRC/frameworks/base/cmds/system_server/library/system_init.cpp`中实现。”

代码块设置如下：

```kt
package android.os.packt; 

interface IPacktCrypto 
{ 
  byte [] getMD5(String data); 
}
```

任何命令行输入或输出都以以下方式编写：

```kt
make -jX where X = number of CPU cores + 2

```

**新术语**和**重要单词**以粗体显示。例如，屏幕上看到的单词，例如菜单或对话框中的单词，会以这种方式出现在文本中：“按住**音量增加**，然后按住**电源**。”

### 注意

警告或重要说明会以这样的方式出现在框中。

### 提示

提示和技巧会以这种方式出现。

# 读者反馈

我们始终欢迎读者的反馈。让我们知道您对本书的看法——您喜欢或不喜欢的地方。读者的反馈对我们开发您真正受益的标题非常重要。

要向我们发送一般反馈，只需发送电子邮件至`<feedback@packtpub.com>`，并在消息主题中提及书名。

如果您在某个专题上有专业知识，并且有兴趣撰写或为一本书做出贡献，请参阅我们的作者指南[www.packtpub.com/authors](http://www.packtpub.com/authors)。

# 客户支持

现在您是 Packt 书籍的自豪所有者，我们有一些事情可以帮助您充分利用您的购买。

## 下载示例代码

您可以从[`www.packtpub.com`](http://www.packtpub.com)的帐户中下载您购买的所有 Packt 图书的示例代码文件。如果您在其他地方购买了本书，您可以访问[`www.packtpub.com/support`](http://www.packtpub.com/support)并注册，以便直接通过电子邮件接收文件。

## 勘误

尽管我们已经尽最大努力确保内容的准确性，但错误是难免的。如果您在我们的书籍中发现错误，无论是文本还是代码方面的错误，我们将不胜感激地接受您的报告。通过这样做，您可以帮助其他读者避免挫折，并帮助我们改进后续版本的书籍。如果您发现任何勘误，请访问[`www.packtpub.com/submit-errata`](http://www.packtpub.com/submit-errata)，选择您的书籍，点击**勘误提交表格**链接，并输入您的勘误详情。一旦您的勘误经过验证，您的提交将被接受，并且勘误将被上传到我们的网站上，或者添加到该书籍的勘误列表中的已有勘误部分。您可以通过访问[`www.packtpub.com/support`](http://www.packtpub.com/support)来查看任何已有的勘误。

## 盗版

互联网上侵犯版权的盗版行为是跨媒体持续存在的问题。在 Packt，我们非常重视版权和许可的保护。如果您在互联网上发现我们作品的任何非法副本，请立即向我们提供位置地址或网站名称，以便我们采取补救措施。

请通过`<copyright@packtpub.com>`与我们联系，并附上涉嫌盗版材料的链接。

我们感谢您帮助保护我们的作者，以及我们为您提供有价值内容的能力。

## 问题

如果您在阅读书籍的过程中遇到任何问题，请通过`<questions@packtpub.com>`与我们联系，我们将尽力解决。
