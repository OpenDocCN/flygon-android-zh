# 第七章：工具

在上一章中，我们了解了 Google 提供的实用服务，开发者可以利用这些服务来改进他们的应用程序。现在，我们将学习 Android Studio 中提供的工具，这些工具使我们的开发工作更加轻松。你是否想知道如何管理 Android 平台？你想要一个项目有清晰的文档吗？如果你作为一个开发者团队工作，并且需要与 Android Studio 集成的版本控制管理器吗？

本章展示了 Android Studio 中提供的最重要的附加工具：Android SDK 工具，Javadoc，以及版本控制集成。首先，我们将了解 Android Studio 中的软件开发工具包管理器，通过它我们可以检查、更新和安装项目所需的不同组件。接下来，我们将回顾 Android 虚拟设备管理器，我们可以在其中编辑将在其中测试我们项目的虚拟设备。我们还将学习如何使用 Javadoc 工具进行完整文档编写，以及如何使用 Android Studio 中可用的系统进行版本控制。

这是我们将在本章中讨论的主题：

+   SDK 管理器

+   AVD 管理器

+   Javadoc

+   版本控制

# 软件开发工具包管理器

**软件开发工具包（SDK）管理器**是集成在 Android Studio 中的一个 Android 工具，用于控制我们的 Android SDK 安装。通过这个工具，我们可以检查系统中安装的 Android 平台，更新它们，安装新平台，或者安装其他组件，比如 Google Play 服务或 Android 支持库。

要从 Android Studio 打开 SDK 管理器，请导航到菜单**工具** | **Android** | **SDK 管理器**。你也可以从工具栏点击快捷方式。在管理器的顶部会显示在 Android Studio 中配置的 SDK 路径。

SDK 管理器会显示可用软件包的列表，包含以下属性：

+   **名称**：软件包或聚合了一些相关软件包的容器名称。

+   **API**：软件包添加时的 API 编号。

+   **版本号**：软件包修订或版本号。

+   **状态**：关于你的系统，软件包的状态。状态可能是**未安装**，**已安装**，**有可用更新**，**不兼容**，或**已过时**。

可以通过列表下方的复选框按状态过滤软件包，并且可以通过 API 级别或它们下载到的存储库进行排序。这些选项也可以从顶部菜单**软件包**中访问。

从菜单**工具** | **管理附加站点**，我们可以查看提供附加组件和额外软件包的官方站点列表。在**用户定义站点**菜单中，我们可以添加自定义的外部站点。

在软件包名称旁边有一个复选框，用于选择我们想要安装、更新或删除的软件包。如下截图所示，默认情况下会选中已安装在我们系统中但有待更新版本的软件包。如果有尚未安装的新安卓平台版本，其软件包也会被选中。

![软件开发工具包管理器](img/5273OS_07_01.jpg)

对话框底部按钮的文本中指示了待安装或更新的选定软件包总数。其下方的按钮指示了待删除的选定软件包总数。

检查需要更新的软件包，如果您还没有安装最新的安卓平台，也请检查，并检查我们应用程序支持的最小平台，安卓 2.3.3（API 10），以便能够使用这个版本在虚拟设备中测试我们的应用程序。点击**安装**按钮。

在下一个对话框中，我们需要接受软件包许可。勾选**接受许可**单选按钮，然后点击**安装**按钮。软件包的安装或更新将开始显示其进度。首先，管理器下载软件包，然后解压，最后安装。

记得时不时检查 SDK 管理器，以查看是否有更新。

# 安卓虚拟设备管理器

**安卓虚拟设备管理器**（**AVD 管理器**）是集成在 Android Studio 中的一个安卓工具，用于管理将在安卓模拟器中执行的安卓虚拟设备。

要从 Android Studio 打开 AVD 管理器，请导航至菜单**工具** | **安卓** | **AVD 管理器**。您也可以从工具栏点击快捷方式。AVD 管理器在默认标签**安卓虚拟设备**中显示现有虚拟设备的列表。由于我们还没有创建任何虚拟设备，最初列表应为空。要创建我们的第一个虚拟设备，请点击**新建**按钮以打开配置对话框：

+   **AVD 名称**：虚拟设备的名称。

+   **设备**：选择一个可用的设备配置。这些配置是我们曾在布局编辑器预览中测试过的。选择 Nexus 4 设备，以在对话框中加载其参数。

+   **目标**：选择设备的安卓平台。我们需要创建一个最小支持我们应用程序的平台虚拟设备，以及一个目标为我们应用程序平台的虚拟设备。这两个平台都是在创建项目时配置的。对于这个第一个虚拟设备，选择目标平台，安卓 4.2.2（API 17）。

+   **CPU/ABI**：选择设备架构。此字段的值在我们选择目标平台时设置。每个平台都有其对应的架构，如果我们没有安装该架构，将会显示以下信息：**此目标没有安装系统镜像**。为解决这个问题，打开 SDK 管理器，查找目标平台的其中一个架构，如 ARM EABI v7a 系统镜像或 Intel x86 Atom 系统镜像。

+   **键盘**：选择是否在模拟器中显示硬件键盘。勾选此项。

+   **皮肤**：选择是否在模拟器中显示额外的硬件控制。勾选此项。

+   **前置摄像头**：选择模拟器是否具有前置摄像头。摄像头可以模拟，也可以通过使用计算机的摄像头实现真实效果。选择**无**。

+   **后置摄像头**：选择模拟器是否具有后置摄像头。选择**无**。

+   **内存选项**：选择虚拟设备的内存参数。保持默认值，除非出现警告信息；在这种情况下，按照信息的指示操作。例如，为**RAM**内存选择 256，为**VM Heap**选择 64。

+   **内部存储**：选择虚拟设备存储的大小，例如：200 MiB。

+   **SD 卡**：选择 SD 卡的大小，或者选择一个文件作为 SD 卡。此参数是可选的。

+   **模拟选项**：**快照**选项可以保存模拟器的状态，以便下次更快地加载。勾选此项。**使用主机 GPU**选项尝试加速 GPU 硬件，使模拟器运行得更快。

给虚拟设备一个有意义的名称以便容易识别，如`AVD_nexus4_api17`。点击**确定**按钮。

新的虚拟设备现在列在 AVD 管理器中，带有绿色勾选图标，表示它是有效的。这些图标表示虚拟设备的状态：是否有效，是否加载失败，或者其状态是否可修复。图标图例在管理器窗口底部解释。选择最近创建的虚拟设备以启用剩余操作：

+   **编辑**：编辑虚拟设备配置。

+   **删除**：删除虚拟设备。

+   **修复**：如果虚拟设备加载失败但可以修复，将提供此选项。此操作将尝试修复虚拟设备的错误状态。

+   **详情**：打开一个对话框，详细显示虚拟设备特性。

+   **启动**：运行虚拟设备。

点击**启动**按钮打开启动对话框。检查与快照相关的选项，然后点击**启动**按钮。模拟器将如下截图所示打开。等待其完全加载，然后你就可以尝试了。

![Android Virtual Device Manager](img/5273OS_07_02.jpg)

从 AVD 管理器中，我们还可以配置设备定义。设备定义用于布局预览，并且是虚拟设备的基础。打开**设备定义**标签页，那里列出了现有的定义。我们可以使用**新建设备**按钮创建一个新的设备定义，可以使用**克隆**按钮轻松地克隆一个现有设备来创建一个新设备，可以使用**删除**按钮删除它们，或者可以使用**创建 AVD**按钮基于设备定义创建一个虚拟设备。

点击**新建设备**按钮检查现有的配置参数。定义一个设备最重要的参数是：

+   **名称**: 设备的名称。

+   **屏幕尺寸（英寸）**: 屏幕尺寸以英寸为单位。这个值决定了设备的尺寸类别。输入一个值`4.0`，注意**尺寸**值（在右侧）是**正常**。现在输入一个值`7.0`，**尺寸**字段将其值更改为**大**。这个参数加上屏幕分辨率也决定了密度类别。

+   **分辨率（像素）**: 屏幕分辨率以像素为单位。这个值决定了设备的密度类别。在 4.0 英寸的屏幕尺寸下，输入一个值`768 x 1280`，注意密度值是**xhdpi**。将屏幕尺寸更改为`6.0`英寸，密度值更改为**hdpi**。现在将分辨率更改为`480 x 800`，密度值是**mdpi**。

+   **传感器**: 设备中可用的传感器：加速度计、GPS、陀螺仪或接近传感器。

+   **RAM**: 设备的 RAM 内存大小。

+   **按钮**: 指示设备的 home、back 或 menu 按钮是通过软件还是硬件提供。

+   **设备状态**: 检查允许的状态。

创建一个屏幕尺寸为 4.7 英寸，分辨率为 800 x 1280，RAM 值为 200 MiB，启用软件按钮，同时启用竖屏和横屏状态的新设备。将其命名为`My Device`。点击**创建设备**按钮。

AVD 管理器现在在设备列表中显示我们的设备定义。在 Android Studio 中，使用图形编辑器打开主布局，并点击设备列表。如下截图所示，我们的自定义设备定义出现，我们可以选择它来预览布局：

![Android 虚拟设备管理器](img/5273OS_07_03.jpg)

# 生成 Javadoc

Javadoc 是一个以 HTML 格式文档化 Java 代码的工具。Javadoc 文档是从添加到 Java 类或方法的注释和标签生成的。注释以`/**`字符串开始，以`*/`结束。在这些注释中，可以添加一些标签，如`@param`描述方法参数，`@throws`描述方法可能抛出的异常，或`@version`指示类或方法的版本。

Android Studio 集成了 Javadoc 的使用。在输入 Javadoc 注释时，我们可以使用代码补全功能，并且文档将显示在代码元素的弹出工具提示中。

为了生成完整的 Javadoc，我们必须编写关于我们的类和方法的 Javadoc 注释。打开项目的主活动，为我们在第五章，*创建用户界面*中创建的方法 `onAcceptClick` 添加 Javadoc 注释。将光标放在方法声明前的一行，输入 `/**` 并按下 *Enter*。Javadoc 注释会自动插入，其中包含方法声明中可用的信息：参数和返回类型。在这种情况下，没有返回类型。

文档注释的第一行是方法描述。然后，解释每个参数和返回类型。现在方法应如下所示：

```java
/**
 * Method executed when the user clicks on the Accept button.
 * Change the greeting message to include the name introduced by the user in the editText box.
 *
 * @param v View the user clicked
 */
public void onAcceptClick(View v) { ... }
```

这些关于方法的信息现在将作为其文档在弹出的对话框中显示。以下屏幕截图显示了应出现在方法上方的对话框：

![生成 Javadoc](img/5273OS_07_04.jpg)

要生成 Javadoc 文档，请在顶部菜单中选择 **工具** | **生成 Javadoc**。将打开一个显示 Javadoc 选项的对话框。我们可以选择范围、输出目录、包含元素的可见性，或者是否要创建层次树、导航栏和索引。

选择 **当前文件** 作为范围以仅生成我们主活动的文档。从您的系统中选择输出目录。将可见性降低到 public 并点击 **确定** 按钮。Javadoc 文档已以 HTML 格式在输出目录中创建，`index.html` 文件是起点。浏览文档以打开 `MainActivity` 类。注意，由于我们将生成的 Javadoc 的可见性降低到 public 元素，所以不显示可见性为 protected 的 `onCreate` 方法。

# 版本控制系统

Android Studio 集成了几种版本控制系统：Git、Mercurial 或 Subversion。要启用版本控制集成，请在顶部菜单中选择 **VCS** | **启用版本控制集成** 并选择系统类型。现在，**VCS** 菜单中添加了一些更多选项。

第一步是从版本控制系统中检出。导航到 **VCS** | **从版本控制检出**，点击添加图标，并输入仓库 URL：

+   要更新整个项目，请导航到 **VCS** | **更新项目**

+   要提交项目的所有更改，请导航到 **VCS** | **提交更改**

+   要清理项目，请导航到 **VCS** | **清理项目**

版本控制操作也可以应用于单个文件。使用鼠标右键点击项目中的任何文件，并选择 **Subversion** 部分。从出现的菜单中，我们可以将文件添加到仓库，添加到忽略列表，浏览更改，恢复更改或锁定它。

控制文件版本的一个更简单的方法是使用本地历史记录。在编辑器中打开主活动文件，导航到 **VCS** | **Local History** | **Show History**。文件历史记录对话框将被打开。在对话框的左侧列出了文件的可用版本。选择一个旧版本与当前文件版本进行比较。旧版本与当前版本之间的差异会被高亮显示。灰色用于表示删除的代码块，蓝色用于突出显示已更改的文本，绿色用于指示新插入的文本。从顶部图标我们可以恢复更改并配置空白显示。下一张截图显示了主活动的两个版本之间的比较。我们可以看到我们最近添加的方法，`onAcceptClick`方法，以绿色突出显示。

![版本控制系统](img/5273OS_07_05.jpg)

我们还可以检查特定代码块的本地历史记录。关闭对话框，从编辑器中选择一些代码行，然后导航到 **VCS** | **Local History** | **Show History for Selection**。将打开相同的历史记录对话框，但这次它显示所选代码的版本。

# 总结

到本章结束时，我们应该具备使用 Android SDK Manager 工具安装、更新或检查项目可用平台的知识。我们应该能够创建一个新的 Android 虚拟设备，并在必要时对其进行编辑。使用 Javadoc，编写项目的完整文档不再是一个问题，我们还应该能够使用 Android Studio 中集成的版本控制系统。

在下一章中，我们将继续使用 Android Studio 的集成功能。在本章中，我们将学习项目模拟和如何进行调试。我们将了解调试器、控制台或 LogCat 工具。我们还将学习更高级的调试工具，如 Dalvik Debug Monitor Server（DDMS）。我们将深入研究这个监控服务器，了解其提供的每种工具。
